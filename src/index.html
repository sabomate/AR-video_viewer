<!-- index.html -->

<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" charset="utf-8" />
    <title>AR-Viewer</title>
    <!-- A-FrameとAR.jsのCDN -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <!-- Firebaseの読み込み -->
    <script type="module" src="firebase.js"></script>
    <script type="module" src="Reader.js"></script>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body style="margin: 0px; overflow: hidden">
    <div class="arjs-loader">
      <div class="animoSpinner"></div>
      <div class="main-logo">
        <div class="icon"><img src="img/icon.png" alt="アイコン画像"></div>
        <p class="product-name">ARバムめーかー</p>
      </div>
      <p class="loading-text">Now Loading...</p>
      <p class="copy-text">&copy;Sabomate</p>
    </div>

    <div class="ui">
      <div id="guideUi">
        <div><img class="back-sakura sakura-top" src="img/sakura.png" alt=""></div>
        <div><img class="back-sakura sakura-bottom" src="img/sakura.png" alt=""></div>
        <div class="guide">
          <p class="guide-text">全体写真をかざしてみよう！</p>
          <div class="frame-img"><img src="img/frame.png" alt=""></div>
        </div>
      </div>
      <button type="button" id="playVideBtn" class="video_play hidden"></button>
      <button type="button" id="changeNextVideoBtn" class="video_change left_btn hidden"></button>
      <button type="button" id="changePreviousVideoBtn" class="video_change right_btn hidden"></button>
      <button type="button" id="VideoPinBtn" class="pin_button hidden"></button>
    </div>

    <!-- ピン止め用の動画 -->
    <video id="pinVideo" src="https://www2.yoslab.net/~minari/sample/taga.mp4" class="pin_video hidden"></video>

    <!-- シーン生成、AR.js呼び出し -->
    <a-scene
      vr-mode-ui="enabled: false;"
      renderer="logarithmicDepthBuffer: true; precision: medium;"
      embedded
      arjs="trackingMethod: best; sourceType: webcam;debugUIEnabled: false;"
    >
      <a-nft
        type="nft"
        id = "nft"
        url="https://www2.yoslab.net/~minari/sample/Yoslab"
        smooth="true"
        smoothCount="10"
        smoothTolerance=".01"
        smoothThreshold="5"
        markerhandler
      >
        <a-text
          id="thumbnailText"
          value="卒業おめでとう！"
          font="keifont-msdf.json"
          font-image="keifont-msdf.png"
          negate="false"
          scale="200 100 50"
          position="100 2 0"
          rotation="-90 0 0"
          color="#fc6c85">
        </a-text>
        <a-obj-model id="gift_box" position="180 0 120" scale="20 20 20" rotation="0 -90 20" src="#crate-obj" mtl="#crate-mtl"></a-obj-model>
        <a-video
          id = "videoFrame"
          src="#arVideo"
          position="180 5 120"
          rotation = "-90 0 0"
          width="90"
          height="160"
          visible="false"
        ></a-video>
      </a-nft>

      <a-assets timeout="30000">
        <a-asset-item id="crate-obj" src="gift_box.obj"></a-asset-item>
        <a-asset-item id="crate-mtl" src="gift_box.mtl"></a-asset-item>
        <video
          id="arVideo"
          src="https://www2.yoslab.net/~minari/sample/taga.mp4"
          crossorigin="anonymous"
        ></video>
      </a-assets>
    </a-scene>

    <script>
      // nftマーカーが読み込まれたときのイベント
      window.addEventListener("arjs-nft-loaded", (event) => {
        // Hide loading overlay
        console.log("nft loaded");
      });
    </script>
  </body>
</html>
